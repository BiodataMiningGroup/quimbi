export default class ColorMap {

    constructor() {
        this._colorMapTextureR = null;
        this._colorMapTextureG = null;
        this._colorMask = [0, 0, 0];
        this._colorMaskLocation = null;
        this._gl = null;
        this.id = 'color-map';
        this.vertexShaderUrl = 'shader/display-rectangle.glsl.vert';
        this.fragmentShaderUrl = 'shader/color-map.glsl.frag';

    }

    setUp(gl, program, assets, helpers) {

        helpers.useInternalVertexPositions(program);
        helpers.useInternalTexturePositions(program);



        this._colorMapTextureR = helpers.newTexture('colorMapTextureR');
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, 256, 1, 0, gl.RGB, gl.UNSIGNED_BYTE, this.getColorMapValues());

        gl.uniform1i(gl.getUniformLocation(program, 'u_color_map_r'), 1);

        //setUpColorMapTexture(gl, assets, helpers);

        this._colorMaskLocation = gl.getUniformLocation(program, 'u_color_mask');
    }

    callback(gl, program, assets, helpers) {
        gl.activeTexture(gl.TEXTURE0);
        gl.bindTexture(gl.TEXTURE_2D, assets.textures.distanceTexture);
        gl.activeTexture(gl.TEXTURE1);
        gl.bindTexture(gl.TEXTURE_2D, this._colorMapTextureR);
        // Todo Which values?
        gl.uniform3f(this._colorMaskLocation, 1, 0, 0);

        gl.bindFramebuffer(gl.FRAMEBUFFER, assets.framebuffers.colorMapTexture);
    }

    postCallback (gl, program, assets, helpers) {
    //assets.framebuffer.updateColors();

    }


    getColorMapValues() {
        return new Uint8Array(
            [
                0, 0, 255, 0, 7, 206, 1, 16, 206, 1, 27, 206, 2, 43, 206, 3, 60, 207, 4, 74, 209, 6, 90, 211, 8, 107, 213, 9,
                115, 214, 10, 123, 215, 11, 133, 216, 13, 140, 216, 14, 146, 216, 16, 154, 217, 17, 160, 217, 20, 167, 217,
                22, 171, 217, 24, 175, 217, 26, 180, 217, 28, 185, 217, 30, 190, 217, 32, 194, 218, 35, 198, 218, 37, 203,
                218, 39, 208, 218, 41, 212, 218, 44, 217, 218, 46, 221, 218, 48, 225, 218, 50, 230, 218, 52, 234, 218, 55,
                239, 218, 56, 242, 219, 58, 244, 219, 60, 248, 219, 62, 251, 219, 64, 253, 219, 66, 255, 219, 68, 255, 219,
                70, 255, 219, 72, 255, 219, 74, 255, 219, 75, 255, 220, 77, 255, 220, 79, 255, 220, 81, 255, 220, 83, 255,
                220, 85, 255, 220, 86, 255, 220, 88, 255, 220, 89, 255, 221, 90, 255, 221, 91, 255, 221, 92, 255, 221, 94,
                255, 221, 95, 255, 221, 95, 255, 222, 96, 255, 222, 96, 255, 223, 97, 255, 223, 98, 255, 223, 98, 255, 224,
                99, 255, 224, 100, 255, 225, 100, 255, 225, 100, 254, 226, 100, 251, 226, 100, 246, 227, 100, 241, 228, 100,
                238, 228, 101, 233, 229, 101, 229, 230, 101, 225, 230, 101, 221, 231, 101, 217, 232, 101, 214, 233, 101, 210,
                234, 101, 206, 235, 101, 202, 236, 101, 200, 237, 101, 196, 238, 101, 193, 239, 102, 191, 240, 102, 188, 241,
                102, 185, 242, 103, 184, 244, 103, 181, 245, 103, 180, 246, 104, 178, 248, 104, 177, 249, 104, 176, 251, 105,
                175, 252, 105, 175, 254, 106, 175, 0, 106, 175, 2, 107, 176, 3, 107, 176, 5, 108, 177, 7, 109, 178, 8, 110,
                180, 10, 110, 181, 11, 111, 184, 12, 111, 186, 14, 113, 188, 15, 113, 190, 17, 114, 193, 18, 115, 195, 19,
                116, 198, 21, 117, 201, 22, 118, 203, 23, 119, 206, 24, 120, 209, 25, 121, 212, 26, 122, 215, 27, 124, 217,
                28, 125, 220, 29, 126, 222, 29, 128, 224, 30, 129, 226, 31, 131, 227, 31, 132, 228, 32, 133, 227, 32, 135,
                228, 32, 137, 228, 33, 138, 228, 33, 140, 228, 33, 141, 228, 34, 143, 228, 34, 145, 228, 34, 147, 228, 35,
                148, 227, 35, 150, 228, 36, 151, 228, 36, 153, 228, 36, 155, 227, 37, 157, 228, 37, 158, 227, 38, 159, 226,
                38, 160, 225, 38, 161, 224, 39, 162, 224, 39, 163, 223, 39, 164, 223, 40, 166, 223, 40, 167, 222, 40, 168,
                221, 41, 169, 220, 41, 169, 219, 42, 170, 218, 42, 171, 218, 43, 172, 217, 43, 174, 216, 44, 174, 216, 44,
                175, 215, 44, 176, 215, 45, 177, 214, 45, 178, 214, 46, 179, 213, 46, 180, 213, 47, 181, 213, 47, 181, 212,
                47, 183, 212, 48, 184, 212, 48, 185, 211, 49, 185, 211, 49, 187, 211, 50, 188, 211, 50, 189, 211, 51,
                189, 211, 51, 190, 210, 52, 192, 210, 52, 193, 210, 53, 193, 210, 53, 195, 210, 53, 196, 211, 54, 197,
                211, 54, 198, 211, 55, 199, 211, 55, 200, 211, 56, 201, 212, 56, 202, 212, 57, 204, 212, 57, 205, 213,
                58, 206, 213, 58, 207, 213, 59, 208, 214, 59, 209, 214, 60, 210, 215, 60, 212, 216, 61, 213, 216, 61,
                214, 217, 62, 215, 218, 62, 216, 218, 62, 217, 219, 63, 218, 220, 63, 220, 221, 64, 220, 221, 64, 222,
                222, 65, 223, 223, 65, 224, 224, 66, 225, 225, 66, 226, 226, 66, 227, 227, 67, 229, 228, 67, 230, 229,
                68, 231, 230, 68, 233, 232, 68, 234, 233, 69, 235, 233, 69, 236, 233, 69, 237, 233, 70, 239, 234, 70,
                239, 233, 70, 241, 233, 71, 242, 233, 71, 243, 232, 72, 243, 229, 72, 244, 225, 72, 245, 221, 72, 245,
                216, 73, 246, 210, 73, 247, 204, 73, 248, 198, 74, 249, 191, 74, 249, 184, 74, 249, 175, 74, 249, 167,
                75, 249, 158, 75, 250, 149, 75, 250, 140, 75, 250, 130, 75, 250, 121, 75, 251, 112, 76, 251, 102, 76,
                251, 92, 76, 252, 82, 76, 252, 72, 77, 252, 62, 77, 253, 52, 77, 253, 41, 77, 253, 36, 77, 254, 31, 77,
                254, 26, 77, 254, 21, 78, 254, 15, 78, 255, 10, 78, 255, 5, 78, 255, 0, 210, 255, 0, 210, 255, 0, 210,
                255, 0, 210, 255, 0, 210, 255, 0, 210, 255, 0, 210, 255, 0, 210
            ]
        );
    }
}